<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CrownRFEP_Reader.Views.QuadPlayerPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:behaviors="clr-namespace:CrownRFEP_Reader.Behaviors"
    xmlns:controls="clr-namespace:CrownRFEP_Reader.Views.Controls"
    xmlns:precision="clr-namespace:CrownRFEP_Reader.Controls"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:CrownRFEP_Reader.ViewModels"
    Title="Análisis Cuádruple"
    x:DataType="vm:QuadPlayerViewModel"
    BackgroundColor="#FF0D0D0D"
    Shell.BackgroundColor="#FF0D0D0D"
    Shell.ForegroundColor="White"
    Shell.TitleColor="White">
    <Shell.NavBarIsVisible>
        <OnPlatform x:TypeArguments="x:Boolean">
            <On Platform="WinUI" Value="False" />
            <On Platform="Default" Value="True" />
        </OnPlatform>
    </Shell.NavBarIsVisible>

    <Grid RowDefinitions="*,Auto">
        <!--  Contenedor de 4 vídeos (2x2)  -->
        <Grid Grid.Row="0" Margin="20,20,20,0"
              RowDefinitions="*,*"
              ColumnDefinitions="*,*"
              RowSpacing="4"
              ColumnSpacing="4">
            
            <!--  Vídeo 1 (arriba izquierda)  -->
            <Border
                Grid.Row="0"
                Grid.Column="0"
                BackgroundColor="#FF3A3A3A"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 8"
                StrokeThickness="2"
                IsVisible="{Binding HasVideo1}">
                <Grid>
                    <precision:PrecisionVideoPlayer
                        x:Name="MediaPlayer1"
                        Aspect="AspectFill"
                        IsMuted="{Binding IsMuted}"
                        BackgroundColor="#FF0D0D0D"
                        Source="{Binding Video1.LocalClipPath}" />
                    <!--  Overlay para scrubbing  -->
                    <BoxView
                        BackgroundColor="Transparent"
                        InputTransparent="False">
                        <BoxView.Behaviors>
                            <behaviors:VideoScrubBehavior VideoIndex="1" />
                        </BoxView.Behaviors>
                    </BoxView>
                    <!--  Controles individuales (modo individual)  -->
                    <Border
                        Margin="8"
                        Padding="8,6"
                        BackgroundColor="#CC000000"
                        HorizontalOptions="Center"
                        VerticalOptions="End"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        IsVisible="{Binding IsIndividualMode}">
                        <HorizontalStackLayout Spacing="8">
                            <controls:SymbolIcon
                                SymbolName="gobackward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand1}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="{Binding PlayPauseIcon1}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeLarge}"
                                HeightRequest="{StaticResource IconSizeLarge}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand1}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="goforward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand1}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <Slider
                                x:Name="ProgressSlider1"
                                WidthRequest="400"
                                Minimum="0"
                                Maximum="1"
                                ThumbColor="#FF6DDDFF"
                                MinimumTrackColor="#FF6DDDFF"
                                MaximumTrackColor="#FF3A3A3A"
                                ValueChanged="OnProgressSlider1ValueChanged"
                                DragStarted="OnProgressSlider1DragStarted"
                                DragCompleted="OnProgressSlider1DragCompleted" />
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeCaption}"
                                Text="{Binding CurrentPositionText1}"
                                TextColor="#CCFFFFFF" />
                            <!--  Mute  -->
                            <controls:SymbolIcon
                                SymbolName="{Binding MuteIcon}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ToggleMuteCommand}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                        </HorizontalStackLayout>
                    </Border>
                    <!--  Nombre del atleta  -->
                    <Border
                        Margin="12"
                        Padding="8,4"
                        BackgroundColor="#99000000"
                        HorizontalOptions="Start"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding Video1.Atleta.NombreCompleto}"
                            TextColor="White" />
                    </Border>
                    <!--  Lap actual (overlay) - esquina derecha inferior  -->
                    <Border
                        Margin="12"
                        Padding="12,8"
                        BackgroundColor="{Binding CurrentLapBgColor1}"
                        HorizontalOptions="End"
                        InputTransparent="True"
                        IsVisible="{Binding HasLapTiming}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        VerticalOptions="End">
                        <Label
                            FontAttributes="Bold"
                            FontSize="{StaticResource FontSizeBody}"
                            Text="{Binding CurrentLapText1}"
                            TextColor="{Binding CurrentLapColor1}" />
                    </Border>
                </Grid>
            </Border>
            
            <!--  Vídeo 2 (arriba derecha)  -->
            <Border
                Grid.Row="0"
                Grid.Column="1"
                BackgroundColor="#FF3A3A3A"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 8"
                StrokeThickness="2"
                IsVisible="{Binding HasVideo2}">
                <Grid>
                    <precision:PrecisionVideoPlayer
                        x:Name="MediaPlayer2"
                        Aspect="AspectFill"
                        IsMuted="{Binding IsMuted}"
                        BackgroundColor="#FF0D0D0D"
                        Source="{Binding Video2.LocalClipPath}" />
                    <!--  Overlay para scrubbing  -->
                    <BoxView
                        BackgroundColor="Transparent"
                        InputTransparent="False">
                        <BoxView.Behaviors>
                            <behaviors:VideoScrubBehavior VideoIndex="2" />
                        </BoxView.Behaviors>
                    </BoxView>
                    <!--  Controles individuales (modo individual)  -->
                    <Border
                        Margin="8"
                        Padding="8,6"
                        BackgroundColor="#CC000000"
                        HorizontalOptions="Center"
                        VerticalOptions="End"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        IsVisible="{Binding IsIndividualMode}">
                        <HorizontalStackLayout Spacing="8">
                            <controls:SymbolIcon
                                SymbolName="gobackward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand2}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="{Binding PlayPauseIcon2}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeLarge}"
                                HeightRequest="{StaticResource IconSizeLarge}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand2}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="goforward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand2}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <Slider
                                x:Name="ProgressSlider2"
                                WidthRequest="400"
                                Minimum="0"
                                Maximum="1"
                                ThumbColor="#FF6DDDFF"
                                MinimumTrackColor="#FF6DDDFF"
                                MaximumTrackColor="#FF3A3A3A"
                                ValueChanged="OnProgressSlider2ValueChanged"
                                DragStarted="OnProgressSlider2DragStarted"
                                DragCompleted="OnProgressSlider2DragCompleted" />
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeCaption}"
                                Text="{Binding CurrentPositionText2}"
                                TextColor="#CCFFFFFF" />
                            <!--  Mute  -->
                            <controls:SymbolIcon
                                SymbolName="{Binding MuteIcon}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ToggleMuteCommand}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                        </HorizontalStackLayout>
                    </Border>
                    <!--  Nombre del atleta  -->
                    <Border
                        Margin="12"
                        Padding="8,4"
                        BackgroundColor="#99000000"
                        HorizontalOptions="Start"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding Video2.Atleta.NombreCompleto}"
                            TextColor="White" />
                    </Border>
                    <!--  Lap actual (overlay) - esquina izquierda inferior  -->
                    <Border
                        Margin="12"
                        Padding="12,8"
                        BackgroundColor="{Binding CurrentLapBgColor2}"
                        HorizontalOptions="Start"
                        InputTransparent="True"
                        IsVisible="{Binding HasLapTiming}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        VerticalOptions="End">
                        <Label
                            FontAttributes="Bold"
                            FontSize="{StaticResource FontSizeBody}"
                            Text="{Binding CurrentLapText2}"
                            TextColor="{Binding CurrentLapColor2}" />
                    </Border>
                </Grid>
            </Border>
            
            <!--  Vídeo 3 (abajo izquierda)  -->
            <Border
                Grid.Row="1"
                Grid.Column="0"
                BackgroundColor="#FF3A3A3A"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 8"
                StrokeThickness="2"
                IsVisible="{Binding HasVideo3}">
                <Grid>
                    <precision:PrecisionVideoPlayer
                        x:Name="MediaPlayer3"
                        Aspect="AspectFill"
                        IsMuted="{Binding IsMuted}"
                        BackgroundColor="#FF0D0D0D"
                        Source="{Binding Video3.LocalClipPath}" />
                    <!--  Overlay para scrubbing  -->
                    <BoxView
                        BackgroundColor="Transparent"
                        InputTransparent="False">
                        <BoxView.Behaviors>
                            <behaviors:VideoScrubBehavior VideoIndex="3" />
                        </BoxView.Behaviors>
                    </BoxView>
                    <!--  Controles individuales (modo individual)  -->
                    <Border
                        Margin="8"
                        Padding="8,6"
                        BackgroundColor="#CC000000"
                        HorizontalOptions="Center"
                        VerticalOptions="End"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        IsVisible="{Binding IsIndividualMode}">
                        <HorizontalStackLayout Spacing="8">
                            <controls:SymbolIcon
                                SymbolName="gobackward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand3}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="{Binding PlayPauseIcon3}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeLarge}"
                                HeightRequest="{StaticResource IconSizeLarge}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand3}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="goforward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand3}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <Slider
                                x:Name="ProgressSlider3"
                                WidthRequest="400"
                                Minimum="0"
                                Maximum="1"
                                ThumbColor="#FF6DDDFF"
                                MinimumTrackColor="#FF6DDDFF"
                                MaximumTrackColor="#FF3A3A3A"
                                ValueChanged="OnProgressSlider3ValueChanged"
                                DragStarted="OnProgressSlider3DragStarted"
                                DragCompleted="OnProgressSlider3DragCompleted" />
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeCaption}"
                                Text="{Binding CurrentPositionText3}"
                                TextColor="#CCFFFFFF" />
                            <!--  Mute  -->
                            <controls:SymbolIcon
                                SymbolName="{Binding MuteIcon}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ToggleMuteCommand}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                        </HorizontalStackLayout>
                    </Border>
                    <!--  Nombre del atleta  -->
                    <Border
                        Margin="12"
                        Padding="8,4"
                        BackgroundColor="#99000000"
                        HorizontalOptions="Start"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding Video3.Atleta.NombreCompleto}"
                            TextColor="White" />
                    </Border>
                    <!--  Lap actual (overlay) - esquina derecha superior  -->
                    <Border
                        Margin="12"
                        Padding="12,8"
                        BackgroundColor="{Binding CurrentLapBgColor3}"
                        HorizontalOptions="End"
                        InputTransparent="True"
                        IsVisible="{Binding HasLapTiming}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontAttributes="Bold"
                            FontSize="{StaticResource FontSizeBody}"
                            Text="{Binding CurrentLapText3}"
                            TextColor="{Binding CurrentLapColor3}" />
                    </Border>
                </Grid>
            </Border>
            
            <!--  Vídeo 4 (abajo derecha)  -->
            <Border
                Grid.Row="1"
                Grid.Column="1"
                BackgroundColor="#FF3A3A3A"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 8"
                StrokeThickness="2"
                IsVisible="{Binding HasVideo4}">
                <Grid>
                    <precision:PrecisionVideoPlayer
                        x:Name="MediaPlayer4"
                        Aspect="AspectFill"
                        IsMuted="{Binding IsMuted}"
                        BackgroundColor="#FF0D0D0D"
                        Source="{Binding Video4.LocalClipPath}" />
                    <!--  Overlay para scrubbing  -->
                    <BoxView
                        BackgroundColor="Transparent"
                        InputTransparent="False">
                        <BoxView.Behaviors>
                            <behaviors:VideoScrubBehavior VideoIndex="4" />
                        </BoxView.Behaviors>
                    </BoxView>
                    <!--  Controles individuales (modo individual)  -->
                    <Border
                        Margin="8"
                        Padding="8,6"
                        BackgroundColor="#CC000000"
                        HorizontalOptions="Center"
                        VerticalOptions="End"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        IsVisible="{Binding IsIndividualMode}">
                        <HorizontalStackLayout Spacing="8">
                            <controls:SymbolIcon
                                SymbolName="gobackward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand4}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="{Binding PlayPauseIcon4}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeLarge}"
                                HeightRequest="{StaticResource IconSizeLarge}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand4}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <controls:SymbolIcon
                                SymbolName="goforward.5"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand4}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                            <Slider
                                x:Name="ProgressSlider4"
                                WidthRequest="400"
                                Minimum="0"
                                Maximum="1"
                                ThumbColor="#FF6DDDFF"
                                MinimumTrackColor="#FF6DDDFF"
                                MaximumTrackColor="#FF3A3A3A"
                                ValueChanged="OnProgressSlider4ValueChanged"
                                DragStarted="OnProgressSlider4DragStarted"
                                DragCompleted="OnProgressSlider4DragCompleted" />
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeCaption}"
                                Text="{Binding CurrentPositionText4}"
                                TextColor="#CCFFFFFF" />
                            <!--  Mute  -->
                            <controls:SymbolIcon
                                SymbolName="{Binding MuteIcon}"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeDefault}"
                                HeightRequest="{StaticResource IconSizeDefault}">
                                <controls:SymbolIcon.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ToggleMuteCommand}" />
                                </controls:SymbolIcon.GestureRecognizers>
                            </controls:SymbolIcon>
                        </HorizontalStackLayout>
                    </Border>
                    <!--  Nombre del atleta  -->
                    <Border
                        Margin="12"
                        Padding="8,4"
                        BackgroundColor="#99000000"
                        HorizontalOptions="Start"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding Video4.Atleta.NombreCompleto}"
                            TextColor="White" />
                    </Border>
                    <!--  Lap actual (overlay) - esquina izquierda superior  -->
                    <Border
                        Margin="12"
                        Padding="12,8"
                        BackgroundColor="{Binding CurrentLapBgColor4}"
                        HorizontalOptions="Start"
                        InputTransparent="True"
                        IsVisible="{Binding HasLapTiming}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0"
                        VerticalOptions="Start">
                        <Label
                            FontAttributes="Bold"
                            FontSize="{StaticResource FontSizeBody}"
                            Text="{Binding CurrentLapText4}"
                            TextColor="{Binding CurrentLapColor4}" />
                    </Border>
                </Grid>
            </Border>

            <!--  Delta central  -->
            <Border
                Grid.RowSpan="2"
                Grid.ColumnSpan="2"
                Padding="16,10"
                BackgroundColor="#CC000000"
                HorizontalOptions="Center"
                InputTransparent="True"
                IsVisible="{Binding HasLapTiming}"
                StrokeShape="RoundRectangle 10"
                StrokeThickness="0"
                VerticalOptions="Center"
                ZIndex="100">
                <Label
                    FontAttributes="Bold"
                    FontSize="{StaticResource FontSizeSubtitle}"
                    Text="{Binding CurrentLapDiffText}"
                    TextColor="White" />
            </Border>
        </Grid>

        <!--  Footer para modo individual  -->
        <Border
            Grid.Row="1"
            Margin="20,10,20,20"
            Padding="16,12"
            BackgroundColor="#FF1A1A1A"
            Stroke="#FF3A3A3A"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1"
            IsVisible="{Binding IsIndividualMode}">
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="16">
                <!--  Toggle Modo (Individual/Simultáneo)  -->
                <Border
                    Padding="12,8"
                    BackgroundColor="#FF2A2A2A"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="0">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleModeCommand}" />
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout Spacing="8">
                        <controls:SymbolIcon
                            SymbolName="rectangle.grid.2x2"
                            TintColor="White"
                            WidthRequest="{StaticResource IconSizeDefault}"
                            HeightRequest="{StaticResource IconSizeDefault}" />
                        <Label
                            VerticalOptions="Center"
                            FontSize="{StaticResource FontSizeBody}"
                            Text="Cambiar a Simultáneo"
                            TextColor="White" />
                    </HorizontalStackLayout>
                </Border>
            </HorizontalStackLayout>
        </Border>

        <!--  Controles de reproducción global (solo visible en modo simultáneo)  -->
        <Border
            Grid.Row="1"
            Margin="20,10,20,20"
            Padding="16,12"
            BackgroundColor="#FF1A1A1A"
            Stroke="#FF3A3A3A"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1"
            IsVisible="{Binding IsSimultaneousMode}">
            <Grid RowDefinitions="Auto,Auto" RowSpacing="12">
                <!--  Barra de progreso  -->
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                    <Label
                        VerticalOptions="Center"
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="{Binding CurrentPositionText}"
                        TextColor="#FF999999" />
                    <Slider
                        x:Name="ProgressSlider"
                        Grid.Column="1"
                        Maximum="1"
                        Minimum="0"
                        ThumbColor="#FF6DDDFF"
                        MinimumTrackColor="#FF6DDDFF"
                        MaximumTrackColor="#FF3A3A3A"
                        DragStarted="OnProgressSliderDragStarted"
                        ValueChanged="OnProgressSliderValueChanged"
                        DragCompleted="OnProgressSliderDragCompleted" />
                    <Label
                        Grid.Column="2"
                        VerticalOptions="Center"
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="{Binding DurationText}"
                        TextColor="#FF999999" />
                </Grid>

                <!--  Botones de control  -->
                <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center" Spacing="20">
                    <!--  Retroceder 5s  -->
                    <controls:SymbolIcon
                        SymbolName="gobackward.5"
                        TintColor="White"
                        WidthRequest="{StaticResource IconSizeLarge}"
                        HeightRequest="{StaticResource IconSizeLarge}">
                        <controls:SymbolIcon.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SeekBackwardCommand}" />
                        </controls:SymbolIcon.GestureRecognizers>
                    </controls:SymbolIcon>
                    
                    <!--  Frame anterior  -->
                    <controls:SymbolIcon
                        SymbolName="backward.frame.fill"
                        TintColor="White"
                        WidthRequest="{StaticResource IconSizeLarge}"
                        HeightRequest="{StaticResource IconSizeLarge}">
                        <controls:SymbolIcon.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding FrameBackwardCommand}" />
                        </controls:SymbolIcon.GestureRecognizers>
                    </controls:SymbolIcon>
                    
                    <!--  Play/Pause  -->
                    <Border
                        Padding="16"
                        BackgroundColor="#FF6DDDFF"
                        StrokeShape="RoundRectangle 30"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PlayPauseCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            SymbolName="{Binding PlayPauseIcon}"
                            TintColor="Black"
                            WidthRequest="{StaticResource IconSizeLarge}"
                            HeightRequest="{StaticResource IconSizeLarge}" />
                    </Border>
                    
                    <!--  Frame siguiente  -->
                    <controls:SymbolIcon
                        SymbolName="forward.frame.fill"
                        TintColor="White"
                        WidthRequest="{StaticResource IconSizeLarge}"
                        HeightRequest="{StaticResource IconSizeLarge}">
                        <controls:SymbolIcon.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding FrameForwardCommand}" />
                        </controls:SymbolIcon.GestureRecognizers>
                    </controls:SymbolIcon>
                    
                    <!--  Avanzar 5s  -->
                    <controls:SymbolIcon
                        SymbolName="goforward.5"
                        TintColor="White"
                        WidthRequest="{StaticResource IconSizeLarge}"
                        HeightRequest="{StaticResource IconSizeLarge}">
                        <controls:SymbolIcon.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SeekForwardCommand}" />
                        </controls:SymbolIcon.GestureRecognizers>
                    </controls:SymbolIcon>

                    <!--  Separador  -->
                    <BoxView WidthRequest="1" HeightRequest="24" BackgroundColor="#FF3A3A3A" />

                    <!--  Velocidad  -->
                    <Border
                        Padding="8,4"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <HorizontalStackLayout Spacing="8">
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeSmall}"
                                Text="{Binding SpeedText}"
                                TextColor="White" />
                            <controls:SymbolIcon
                                SymbolName="chevron.up.chevron.down"
                                TintColor="#FF999999"
                                WidthRequest="{StaticResource IconSizeSmall}"
                                HeightRequest="{StaticResource IconSizeSmall}" />
                        </HorizontalStackLayout>
                        <FlyoutBase.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="0.25x" Command="{Binding SetSpeedCommand}" CommandParameter="0.25" />
                                <MenuFlyoutItem Text="0.5x" Command="{Binding SetSpeedCommand}" CommandParameter="0.5" />
                                <MenuFlyoutItem Text="0.75x" Command="{Binding SetSpeedCommand}" CommandParameter="0.75" />
                                <MenuFlyoutItem Text="1x" Command="{Binding SetSpeedCommand}" CommandParameter="1" />
                                <MenuFlyoutItem Text="1.25x" Command="{Binding SetSpeedCommand}" CommandParameter="1.25" />
                                <MenuFlyoutItem Text="1.5x" Command="{Binding SetSpeedCommand}" CommandParameter="1.5" />
                                <MenuFlyoutItem Text="2x" Command="{Binding SetSpeedCommand}" CommandParameter="2" />
                            </MenuFlyout>
                        </FlyoutBase.ContextFlyout>
                    </Border>

                    <!--  Toggle Modo (Individual/Simultáneo)  -->
                    <Border
                        Padding="8,4"
                        BackgroundColor="{Binding IsSimultaneousMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF6DDDFF|#FF2A2A2A'}"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleModeCommand}" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="6">
                            <controls:SymbolIcon
                                SymbolName="rectangle.grid.2x2"
                                TintColor="{Binding IsSimultaneousMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                                WidthRequest="{StaticResource IconSizeMedium}"
                                HeightRequest="{StaticResource IconSizeMedium}" />
                            <Label
                                VerticalOptions="Center"
                                FontSize="{StaticResource FontSizeSmall}"
                                Text="{Binding ModeText}"
                                TextColor="{Binding IsSimultaneousMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}" />
                        </HorizontalStackLayout>
                    </Border>

                    <!--  Mute  -->
                    <Border
                        Padding="8,4"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleMuteCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            SymbolName="{Binding MuteIcon}"
                            TintColor="White"
                            WidthRequest="{StaticResource IconSizeMedium}"
                            HeightRequest="{StaticResource IconSizeMedium}" />
                    </Border>

                    <!--  Separador  -->
                    <BoxView WidthRequest="1" HeightRequest="24" BackgroundColor="#FF3A3A3A" />

                    <!--  Sincronizar por laps  -->
                    <Border
                        Padding="8,4"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <Label
                                Text="Sincronizar laps"
                                TextColor="White"
                                FontSize="{StaticResource FontSizeSmall}"
                                VerticalOptions="Center" />
                            <Switch
                                IsToggled="{Binding IsLapSyncEnabled, Mode=TwoWay}"
                                VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Border>

                    <!--  Botón de exportación  -->
                    <Border
                        Padding="8,4"
                        BackgroundColor="{Binding IsExporting, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF34C759|#FF2A2A2A'}"
                        IsEnabled="{Binding CanExport}"
                        Opacity="{Binding CanExport, Converter={StaticResource BoolToDoubleConverter}}"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ExportCommand}" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="6">
                            <controls:SymbolIcon
                                HeightRequest="{StaticResource IconSizeMedium}"
                                IsVisible="{Binding IsExporting, Converter={StaticResource InvertedBoolConverter}}"
                                SymbolName="square.and.arrow.up"
                                TintColor="White"
                                WidthRequest="{StaticResource IconSizeMedium}" />
                            <Label
                                Text="{Binding ExportStatus, TargetNullValue='Exportar'}"
                                TextColor="White"
                                FontSize="{StaticResource FontSizeSmall}"
                                VerticalOptions="Center"
                                IsVisible="{Binding IsExporting}" />
                            <Label
                                Text="Exportar"
                                TextColor="White"
                                FontSize="{StaticResource FontSizeSmall}"
                                VerticalOptions="Center"
                                IsVisible="{Binding IsExporting, Converter={StaticResource InvertedBoolConverter}}" />
                        </HorizontalStackLayout>
                    </Border>
                </HorizontalStackLayout>
            </Grid>
        </Border>
    </Grid>
</ContentPage>
