<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="CrownRFEP_Reader.Views.Controls.DashboardIconColorPickerView"
    x:Name="ThisPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:CrownRFEP_Reader.Converters"
    xmlns:controls="clr-namespace:CrownRFEP_Reader.Views.Controls"
    xmlns:vm="clr-namespace:CrownRFEP_Reader.ViewModels"
    x:DataType="vm:DashboardViewModel"
    IsVisible="{Binding Layout.ShowIconColorPickerPopup, FallbackValue=False, TargetNullValue=False}">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:HexStringToColorConverter x:Key="HexStringToColorConverter" />
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <!--  Popup de selección de icono y color  -->
    <Grid BackgroundColor="#CC000000">
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding CloseIconColorPickerCommand}" />
        </Grid.GestureRecognizers>
        <Border
            Padding="20"
            BackgroundColor="#FF1E1E1E"
            HorizontalOptions="Center"
            Stroke="#FF3A3A3A"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1"
            VerticalOptions="Center"
            WidthRequest="380">
            <Border.GestureRecognizers>
                <TapGestureRecognizer />
            </Border.GestureRecognizers>
            <VerticalStackLayout Spacing="16">
                <!--  Cabecera con título y botón cerrar  -->
                <Grid ColumnDefinitions="*,Auto">
                    <Label
                        Grid.Column="0"
                        FontAttributes="None"
                        FontSize="{StaticResource FontSizeTitle}"
                        Text="{Binding IconColorPickerTitle}"
                        TextColor="White"
                        VerticalOptions="Center" />
                    <Border
                        Grid.Column="1"
                        Padding="4"
                        BackgroundColor="Transparent"
                        Stroke="Transparent"
                        StrokeShape="RoundRectangle 4">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding CloseIconColorPickerCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="{StaticResource IconSizeLarge}"
                            SymbolName="xmark"
                            TintColor="#FF888888"
                            WidthRequest="{StaticResource IconSizeLarge}" />
                    </Border>
                </Grid>

                <!--  Fila de colores  -->
                <VerticalStackLayout Spacing="8">
                    <Label
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="Color"
                        TextColor="#FF888888" />
                    <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                        <!--  Círculos de color con marca de selección  -->
                        <!-- Blanco -->
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFFFFFFF"
                            StrokeShape="RoundRectangle 14"
                            Stroke="#FF888888"
                            StrokeThickness="1">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFFFFFFF">
                                    <Setter Property="Stroke" Value="#FF0A84FF" />
                                    <Setter Property="StrokeThickness" Value="3" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFFFFFFF" />
                            </Border.GestureRecognizers>
                        </Border>
                        <!-- Gris -->
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FF888888"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FF888888">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FF888888" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFFF453A"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFFF453A">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFFF453A" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFFF9F0A"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFFF9F0A">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFFF9F0A" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFFFD60A"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFFFD60A">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFFFD60A" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FF30D158"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FF30D158">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FF30D158" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FF64D2FF"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FF64D2FF">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FF64D2FF" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FF0A84FF"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FF0A84FF">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FF0A84FF" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFBF5AF2"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFBF5AF2">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFBF5AF2" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FFFF375F"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FFFF375F">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FFFF375F" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border
                            WidthRequest="28"
                            HeightRequest="28"
                            BackgroundColor="#FF0066"
                            StrokeShape="RoundRectangle 14"
                            Stroke="Transparent"
                            StrokeThickness="3">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedPickerColor}" Value="#FF0066">
                                    <Setter Property="Stroke" Value="White" />
                                </DataTrigger>
                            </Border.Triggers>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SelectPickerColorCommand}" CommandParameter="#FF0066" />
                            </Border.GestureRecognizers>
                        </Border>
                    </HorizontalStackLayout>
                </VerticalStackLayout>

                <!--  Separador  -->
                <BoxView HeightRequest="1" BackgroundColor="#FF3A3A3A" />

                <!--  Grid de iconos  -->
                <VerticalStackLayout Spacing="8">
                    <Label
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="Icono"
                        TextColor="#FF888888" />
                    <FlexLayout
                        Direction="Row"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignContent="Start"
                        BindableLayout.ItemsSource="{Binding AvailableIcons}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="vm:IconPickerItem">
                                <Border
                                    Margin="4"
                                    Padding="8"
                                    BackgroundColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FF3A5A6A|#FF2A2A2A}"
                                    StrokeShape="RoundRectangle 6"
                                    Stroke="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FF0066|Transparent}"
                                    StrokeThickness="2"
                                    WidthRequest="40"
                                    HeightRequest="40">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference ThisPage}, Path=BindingContext.SelectPickerIconCommand}"
                                            CommandParameter="{Binding Name}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon
                                        SymbolName="{Binding Name}"
                                        TintColor="{Binding Source={x:Reference ThisPage}, Path=BindingContext.SelectedPickerColor, Converter={StaticResource HexStringToColorConverter}}"
                                        WidthRequest="20"
                                        HeightRequest="20"
                                        HorizontalOptions="Center"
                                        VerticalOptions="Center" />
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </FlexLayout>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentView>
