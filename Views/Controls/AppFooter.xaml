<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="CrownRFEP_Reader.Views.Controls.AppFooter"
    x:Name="ThisFooter"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:CrownRFEP_Reader.Views.Controls"
    HeightRequest="{StaticResource FooterHeight}"
    BackgroundColor="{StaticResource OffBlack}">

    <Grid BackgroundColor="{StaticResource OffBlack}">
        <!--  Línea separadora superior  -->
        <BoxView
            HeightRequest="0.6"
            VerticalOptions="Start"
            Color="#FF3A3A3A" />
        <!--  Contenido principal del footer  -->
        <Grid
            Padding="16,0"
            BackgroundColor="{StaticResource OffBlack}"
            ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto,Auto,Auto,Auto"
            ColumnSpacing="20"
            VerticalOptions="Center">

            <!--  Estado de la BD con botón de logs  -->
            <Border
                Grid.Column="0"
                Padding="6,2"
                BackgroundColor="Transparent"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 4">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnDatabaseStatusTapped" />
                </Border.GestureRecognizers>
                <HorizontalStackLayout Spacing="5">
                    <controls:SymbolIcon
                        x:Name="DatabaseStatusIcon"
                        SymbolName="checkmark.circle.fill"
                        TintColor="#FF4CAF50"
                        HeightRequest="{StaticResource IconSizeSmall}"
                        WidthRequest="{StaticResource IconSizeSmall}"
                        VerticalOptions="Center" />
                    <Label
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="BD"
                        TextColor="#FF8A8A8A"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!--  Estado del backend  -->
            <Border
                Grid.Column="1"
                Padding="6,2"
                BackgroundColor="Transparent"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 4">
                <HorizontalStackLayout Spacing="5">
                    <controls:SymbolIcon
                        x:Name="BackendStatusIcon"
                        SymbolName="arrow.triangle.2.circlepath"
                        TintColor="#FF6DDDFF"
                        HeightRequest="{StaticResource IconSizeSmall}"
                        WidthRequest="{StaticResource IconSizeSmall}"
                        VerticalOptions="Center" />
                    <Label
                        x:Name="BackendStatusLabel"
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="Backend..."
                        TextColor="#FF8A8A8A"
                        VerticalOptions="Center" />
                    <BoxView
                        WidthRequest="1"
                        HeightRequest="16"
                        Margin="6,0"
                        Color="#FF3A3A3A"
                        VerticalOptions="Center" />
                    <controls:SymbolIcon
                        x:Name="NetworkStatusIcon"
                        SymbolName="wifi"
                        TintColor="#FF4CAF50"
                        HeightRequest="{StaticResource IconSizeSmall}"
                        WidthRequest="{StaticResource IconSizeSmall}"
                        VerticalOptions="Center" />
                    <Label
                        x:Name="NetworkStatusLabel"
                        FontSize="{StaticResource FontSizeSmall}"
                        Text="Red..."
                        TextColor="#FF8A8A8A"
                        VerticalOptions="Center" />
                    <Label
                        Text="·"
                        FontSize="{StaticResource FontSizeSmall}"
                        TextColor="#FF5A5A5A"
                        VerticalOptions="Center" />
                    <Label
                        x:Name="NetworkSpeedLabel"
                        FontSize="{StaticResource FontSizeSmall}"
                        FontFamily="{StaticResource AppFontMono}"
                        Text="Velocidad --"
                        TextColor="#FF8A8A8A"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!--  Indicador de operación en curso  -->
            <HorizontalStackLayout
                x:Name="OperationPanel"
                Grid.Column="2"
                Spacing="8"
                IsVisible="False"
                VerticalOptions="Center">
                <ActivityIndicator
                    x:Name="OperationIndicator"
                    HeightRequest="16"
                    WidthRequest="16"
                    IsRunning="True"
                    Color="#FF4CAF50" />
                <Label
                    x:Name="OperationLabel"
                    FontSize="{StaticResource FontSizeBody}"
                    TextColor="#FFB0B0B0"
                    VerticalOptions="Center" />
                <Label
                    x:Name="ProgressLabel"
                    FontSize="{StaticResource FontSizeBody}"
                    FontFamily="{StaticResource AppFontMono}"
                    TextColor="#FF8A8A8A"
                    VerticalOptions="Center" />

                <ProgressBar
                    x:Name="OperationProgressBar"
                    WidthRequest="120"
                    HeightRequest="4"
                    ProgressColor="#FF6DDDFF"
                    BackgroundColor="#FF2A2A2A"
                    VerticalOptions="Center"
                    IsVisible="False" />
            </HorizontalStackLayout>

            <!--  Mensaje de estado (cuando no hay operación)  -->
            <Label
                x:Name="StatusLabel"
                Grid.Column="2"
                FontSize="{StaticResource FontSizeBody}"
                Text="Listo"
                TextColor="#FF6A6A6A"
                VerticalOptions="Center" />

            <!--  Spacer central  -->
            <BoxView Grid.Column="3" Color="{StaticResource OffBlack}" />

            <!--  Información de sincronización de videos (opcional, desde SinglePlayerPage)  -->
            <HorizontalStackLayout
                x:Name="SyncInfoPanel"
                Grid.Column="3"
                Spacing="16"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                IsVisible="{Binding ShowSyncInfo, Source={x:Reference ThisFooter}}">
                <HorizontalStackLayout Spacing="6">
                    <controls:SymbolIcon
                        SymbolName="arrow.triangle.2.circlepath"
                        TintColor="#FF4CAF50"
                        HeightRequest="{StaticResource IconSizeSmall}"
                        WidthRequest="{StaticResource IconSizeSmall}"
                        VerticalOptions="Center" />
                    <Label
                        x:Name="SyncStatusLabel"
                        FontSize="{StaticResource FontSizeSmall}"
                        FontFamily="{StaticResource AppFontMono}"
                        Text="{Binding SyncStatusText, Source={x:Reference ThisFooter}}"
                        TextColor="#FF8A8A8A"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
                <Label
                    x:Name="SyncDeltaLabel"
                    FontSize="{StaticResource FontSizeSmall}"
                    FontFamily="{StaticResource AppFontMono}"
                    Text="{Binding SyncDeltaText, Source={x:Reference ThisFooter}}"
                    TextColor="#FFFFAB40"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!--  Barra de sincronización cloud (Dashboard)  -->
            <Border
                x:Name="SyncStatusBar"
                Grid.Column="4"
                Padding="10,6"
                BackgroundColor="#FF1E1E1E"
                Stroke="#FF333333"
                StrokeShape="RoundRectangle 8"
                StrokeThickness="1"
                IsVisible="{Binding SyncStatusText, Converter={StaticResource IsNotNullConverter}}">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                    <!--  Icono de cloud  -->
                    <controls:SymbolIcon
                        Grid.Column="0"
                        HeightRequest="{StaticResource IconSizeSmall}"
                        WidthRequest="{StaticResource IconSizeSmall}"
                        SymbolName="icloud.and.arrow.up"
                        TintColor="{Binding SyncStatusColor, FallbackValue='#9E9E9E'}"
                        VerticalOptions="Center" />

                    <!--  Texto de estado  -->
                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding SyncStatusText, FallbackValue='Sincronización'}"
                            TextColor="White"
                            IsVisible="{Binding IsSyncing, Converter={StaticResource InvertedBoolConverter}}" />
                        <Label
                            FontSize="{StaticResource FontSizeSmall}"
                            Text="{Binding SyncStatusText}"
                            TextColor="#4CAF50"
                            IsVisible="{Binding IsSyncing}" />
                        <Label
                            FontSize="{StaticResource FontSizeCaption}"
                            TextColor="#888888"
                            IsVisible="{Binding HasPendingSync}">
                            <Label.Text>
                                <MultiBinding StringFormat="{}{0} videos pendientes">
                                    <Binding Path="PendingSyncCount" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                        <!--  Barra de progreso durante sincronización  -->
                        <ProgressBar
                            HeightRequest="4"
                            Progress="{Binding SyncProgress, Converter={StaticResource ProgressConverter}, ConverterParameter=100}"
                            ProgressColor="#4CAF50"
                            IsVisible="{Binding IsSyncing}" />
                    </VerticalStackLayout>

                    <!--  Botón de sincronización  -->
                    <Border
                        Grid.Column="2"
                        Padding="10,6"
                        BackgroundColor="#FF0066"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0"
                        IsVisible="{Binding IsSyncing, Converter={StaticResource InvertedBoolConverter}}">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SyncAllCommand}" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="6">
                            <controls:SymbolIcon
                                HeightRequest="{StaticResource IconSizeSmall}"
                                WidthRequest="{StaticResource IconSizeSmall}"
                                SymbolName="arrow.triangle.2.circlepath"
                                TintColor="White"
                                VerticalOptions="Center" />
                            <Label
                                FontSize="{StaticResource FontSizeSmall}"
                                Text="Sincronizar"
                                TextColor="White"
                                VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Border>

                    <!--  Indicador de progreso giratorio durante sincronización  -->
                    <ActivityIndicator
                        Grid.Column="2"
                        Color="#4CAF50"
                        IsRunning="{Binding IsSyncing}"
                        IsVisible="{Binding IsSyncing}"
                        HeightRequest="20"
                        WidthRequest="20" />
                </Grid>
            </Border>

            <!--  Contador de vídeos  -->
            <HorizontalStackLayout
                Grid.Column="5"
                Spacing="6"
                VerticalOptions="Center">
                <controls:SymbolIcon
                    SymbolName="film"
                    TintColor="#FF8A8A8A"
                    HeightRequest="{StaticResource IconSizeSmall}"
                    WidthRequest="{StaticResource IconSizeSmall}"
                    VerticalOptions="Center" />
                <Label
                    x:Name="VideoCountLabel"
                    FontSize="{StaticResource FontSizeBody}"
                    FontFamily="{StaticResource AppFontMono}"
                    Text="0 vídeos"
                    TextColor="#FF8A8A8A"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!--  Contador de sesiones  -->
            <HorizontalStackLayout
                Grid.Column="6"
                Spacing="6"
                VerticalOptions="Center">
                <controls:SymbolIcon
                    SymbolName="folder"
                    TintColor="#FF8A8A8A"
                    HeightRequest="{StaticResource IconSizeSmall}"
                    WidthRequest="{StaticResource IconSizeSmall}"
                    VerticalOptions="Center" />
                <Label
                    x:Name="SessionCountLabel"
                    FontSize="{StaticResource FontSizeBody}"
                    FontFamily="{StaticResource AppFontMono}"
                    Text="0 sesiones"
                    TextColor="#FF8A8A8A"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!--  Separador vertical  -->
            <BoxView
                Grid.Column="7"
                Margin="2,6"
                BackgroundColor="#FF3A3A3A"
                WidthRequest="1"
                VerticalOptions="Fill" />

            <!--  Usuario actual  -->
            <HorizontalStackLayout
                Grid.Column="8"
                Spacing="8"
                VerticalOptions="Center">
                <Border
                    x:Name="UserPhotoContainer"
                    HeightRequest="22"
                    WidthRequest="22"
                    Stroke="#FF4A4A4A"
                    StrokeThickness="1"
                    IsVisible="False">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="11" />
                    </Border.StrokeShape>
                    <Image
                        x:Name="UserPhotoImage"
                        Aspect="AspectFill" />
                </Border>
                <controls:SymbolIcon
                    x:Name="UserIconPlaceholder"
                    SymbolName="person.circle"
                    TintColor="#FF8A8A8A"
                    HeightRequest="{StaticResource IconSizeMedium}"
                    WidthRequest="{StaticResource IconSizeMedium}"
                    VerticalOptions="Center" />
                <Label
                    x:Name="UserNameLabel"
                    FontSize="{StaticResource FontSizeBody}"
                    Text="Sin perfil"
                    TextColor="#FFB0B0B0"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>

        </Grid>

    </Grid>

</ContentView>
