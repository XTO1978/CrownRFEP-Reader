<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CrownRFEP_Reader.ViewModels"
             xmlns:models="clr-namespace:CrownRFEP_Reader.Models"
             xmlns:controls="clr-namespace:CrownRFEP_Reader.Views.Controls"
             x:Class="CrownRFEP_Reader.Views.AthleteDetailPage"
             x:DataType="vm:AthleteDetailViewModel"
             Title="{Binding Title}" BackgroundColor="#FF121212">

    <Grid RowDefinitions="Auto,*,Auto" Padding="15">
        
        <!-- Info del atleta -->
        <Frame Grid.Row="0" Padding="20" CornerRadius="12" HasShadow="True" Margin="0,0,0,15" BackgroundColor="#FF121212">
            <Grid ColumnDefinitions="80,*">
                <!-- Avatar grande -->
                <Frame WidthRequest="80" 
                       HeightRequest="80" 
                       CornerRadius="40" 
                       Padding="0"
                       HasShadow="False"
                       BackgroundColor="{StaticResource Primary}">
                    <Label Text="ðŸƒ" 
                           FontSize="{StaticResource FontSizeDisplay}" 
                           HorizontalOptions="Center" 
                           VerticalOptions="Center"/>
                </Frame>
                
                <!-- Info -->
                <VerticalStackLayout Grid.Column="1" Margin="20,0,0,0" VerticalOptions="Center">
                    <Label Text="{Binding Athlete.NombreCompleto}" 
                           FontSize="{StaticResource FontSizeHeader}" 
                           FontAttributes="Bold"/>
                    <Label Text="{Binding Athlete.CategoriaNombre}" 
                           FontSize="{StaticResource FontSizeSubtitle}" 
                           TextColor="Gray"/>
                    
                    <HorizontalStackLayout Spacing="20" Margin="0,10,0,0">
                        <VerticalStackLayout>
                            <Label Text="{Binding TotalVideos}" 
                                   FontSize="{StaticResource FontSizeTitle}" 
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Center"/>
                            <Label Text="Videos" FontSize="{StaticResource FontSizeSmall}" TextColor="Gray"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout>
                            <Label Text="{Binding TotalDurationFormatted}" 
                                   FontSize="{StaticResource FontSizeTitle}" 
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Center"/>
                            <Label Text="DuraciÃ³n" FontSize="{StaticResource FontSizeSmall}" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- Videos del atleta -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding RefreshCommand}" 
                     IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding Videos}"
                            SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                     Span="3" 
                                     HorizontalItemSpacing="10" 
                                     VerticalItemSpacing="10"/>
                </CollectionView.ItemsLayout>
                <CollectionView.Header>
                    <Label Text="Videos" FontSize="{StaticResource FontSizeTitle}" FontAttributes="Bold" Margin="0,0,0,10"/>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:VideoClip">
                        <Frame Padding="0" CornerRadius="10" HasShadow="True" IsClippedToBounds="True">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AthleteDetailViewModel}}, Path=PlayVideoCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                            
                            <Grid RowDefinitions="100,Auto">
                                <!-- Thumbnail -->
                                <Image Source="{Binding LocalThumbnailPath}"
                                       Aspect="AspectFill"
                                       BackgroundColor="{StaticResource Gray300}"/>
                                
                                <!-- Play overlay -->
                                <Frame BackgroundColor="#80000000" 
                                       HasShadow="False" 
                                       CornerRadius="20"
                                       WidthRequest="40"
                                       HeightRequest="40"
                                       Padding="0"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center">
                                    <Label Text="â–¶" 
                                           FontSize="{StaticResource FontSizeSubtitle}" 
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Frame>
                                
                                <!-- DuraciÃ³n -->
                                <Frame BackgroundColor="#CC000000" 
                                       HasShadow="False" 
                                       CornerRadius="5"
                                       Padding="5,2"
                                       Margin="5"
                                       HorizontalOptions="End"
                                       VerticalOptions="End">
                                    <Label Text="{Binding DurationFormatted}" 
                                           FontSize="{StaticResource FontSizeCaption}" 
                                           TextColor="White"/>
                                </Frame>
                                
                                <!-- Info -->
                                <VerticalStackLayout Grid.Row="1" Padding="8" Spacing="2">
                                    <Label Text="{Binding CreationDateTime, StringFormat='{0:dd/MM/yyyy}'}" 
                                           FontSize="{StaticResource FontSizeSmall}" 
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding CreationDateTime, StringFormat='{0:HH:mm}'}" 
                                           FontSize="{StaticResource FontSizeCaption}" 
                                           TextColor="Gray"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="40">
                        <Label Text="ðŸŽ¬" FontSize="{StaticResource FontSizeDisplay}" HorizontalOptions="Center"/>
                        <Label Text="No hay videos para este atleta" 
                               FontSize="{StaticResource FontSizeTitle}" 
                               HorizontalOptions="Center" 
                               TextColor="Gray"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- Indicador de carga -->
        <ActivityIndicator Grid.RowSpan="2" 
                           IsRunning="{Binding IsBusy}" 
                           IsVisible="{Binding IsBusy}"
                           Color="{StaticResource Primary}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>

        <!--  Footer de la aplicaciÃ³n  -->
        <controls:AppFooter Grid.Row="2" />
    </Grid>
</ContentPage>
