<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CrownRFEP_Reader.Views.ParallelPlayerPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:CrownRFEP_Reader.Views.Controls"
    xmlns:precision="clr-namespace:CrownRFEP_Reader.Controls"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:CrownRFEP_Reader.ViewModels"
    Title="Análisis Paralelo"
    x:DataType="vm:ParallelPlayerViewModel"
    BackgroundColor="#FF0D0D0D"
    Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*,Auto">
        <!--  Contenedor de vídeos  -->
        <Grid Grid.Row="0" Margin="20,20,20,0">
            <!--  Layout Horizontal  -->
            <Grid
                ColumnDefinitions="*,*"
                ColumnSpacing="12"
                IsVisible="{Binding IsHorizontalOrientation}">
                <!--  Vídeo 1  -->
                <Grid RowDefinitions="*,Auto">
                    <Border
                        BackgroundColor="#FF1A1A1A"
                        Stroke="#FF3A3A3A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1">
                        <Grid>
                            <precision:PrecisionVideoPlayer
                                x:Name="MediaPlayer1H"
                                Aspect="AspectFit"
                                IsMuted="False"
                                Source="{Binding Video1.LocalClipPath}" />
                            <!--  Nombre del atleta  -->
                            <Border
                                Margin="12"
                                Padding="8,4"
                                BackgroundColor="#99000000"
                                HorizontalOptions="Start"
                                StrokeShape="RoundRectangle 4"
                                StrokeThickness="0"
                                VerticalOptions="End">
                                <Label
                                    FontSize="12"
                                    Text="{Binding Video1.Atleta.NombreCompleto}"
                                    TextColor="White" />
                            </Border>
                        </Grid>
                    </Border>
                    <!--  Controles individuales Video 1 (modo individual)  -->
                    <Border
                        Grid.Row="1"
                        Margin="0,8,0,0"
                        Padding="12,8"
                        BackgroundColor="#FF1A1A1A"
                        IsVisible="{Binding IsIndividualMode}"
                        Stroke="#FF3A3A3A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1">
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="8">
                            <!--  Barra de progreso  -->
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                <Label
                                    Text="{Binding CurrentPositionText1}"
                                    TextColor="#FFB1B1B1"
                                    FontSize="10"
                                    VerticalOptions="Center" />
                                <Slider
                                    x:Name="ProgressSlider1H"
                                    Grid.Column="1"
                                    Maximum="1"
                                    Minimum="0"
                                    Value="{Binding Progress1}"
                                    ThumbColor="#FF6DDDFF"
                                    MinimumTrackColor="#FF6DDDFF"
                                    MaximumTrackColor="#FF3A3A3A"
                                    DragStarted="OnSlider1DragStarted"
                                    ValueChanged="OnSlider1ValueChanged"
                                    DragCompleted="OnSlider1DragCompleted" />
                                <Label
                                    Grid.Column="2"
                                    Text="{Binding DurationText1}"
                                    TextColor="#FFB1B1B1"
                                    FontSize="10"
                                    VerticalOptions="Center" />
                            </Grid>
                            <!--  Botones de control  -->
                            <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center" Spacing="8">
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FrameBackwardCommand1}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="backward.frame.fill" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SeekBackwardCommand1}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="gobackward.5" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="10" BackgroundColor="#FF6DDDFF" StrokeShape="RoundRectangle 20" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding PlayPauseCommand1}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="18" SymbolName="{Binding PlayPauseIcon1}" TintColor="Black" WidthRequest="18" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SeekForwardCommand1}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="goforward.5" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FrameForwardCommand1}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="forward.frame.fill" TintColor="White" WidthRequest="16" />
                                </Border>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </Grid>
                <!--  Vídeo 2  -->
                <Grid Grid.Column="1" RowDefinitions="*,Auto">
                    <Border
                        BackgroundColor="#FF1A1A1A"
                        Stroke="#FF3A3A3A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1">
                        <Grid>
                            <precision:PrecisionVideoPlayer
                                x:Name="MediaPlayer2H"
                                Aspect="AspectFit"
                                IsMuted="False"
                                Source="{Binding Video2.LocalClipPath}" />
                            <!--  Nombre del atleta  -->
                            <Border
                                Margin="12"
                                Padding="8,4"
                                BackgroundColor="#99000000"
                                HorizontalOptions="Start"
                                StrokeShape="RoundRectangle 4"
                                StrokeThickness="0"
                                VerticalOptions="End">
                                <Label
                                    FontSize="12"
                                    Text="{Binding Video2.Atleta.NombreCompleto}"
                                    TextColor="White" />
                            </Border>
                        </Grid>
                    </Border>
                    <!--  Controles individuales Video 2 (modo individual)  -->
                    <Border
                        Grid.Row="1"
                        Margin="0,8,0,0"
                        Padding="12,8"
                        BackgroundColor="#FF1A1A1A"
                        IsVisible="{Binding IsIndividualMode}"
                        Stroke="#FF3A3A3A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1">
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="8">
                            <!--  Barra de progreso  -->
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                <Label
                                    Text="{Binding CurrentPositionText2}"
                                    TextColor="#FFB1B1B1"
                                    FontSize="10"
                                    VerticalOptions="Center" />
                                <Slider
                                    x:Name="ProgressSlider2H"
                                    Grid.Column="1"
                                    Maximum="1"
                                    Minimum="0"
                                    Value="{Binding Progress2}"
                                    ThumbColor="#FF6DDDFF"
                                    MinimumTrackColor="#FF6DDDFF"
                                    MaximumTrackColor="#FF3A3A3A"
                                    DragStarted="OnSlider2DragStarted"
                                    ValueChanged="OnSlider2ValueChanged"
                                    DragCompleted="OnSlider2DragCompleted" />
                                <Label
                                    Grid.Column="2"
                                    Text="{Binding DurationText2}"
                                    TextColor="#FFB1B1B1"
                                    FontSize="10"
                                    VerticalOptions="Center" />
                            </Grid>
                            <!--  Botones de control  -->
                            <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center" Spacing="8">
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FrameBackwardCommand2}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="backward.frame.fill" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SeekBackwardCommand2}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="gobackward.5" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="10" BackgroundColor="#FF6DDDFF" StrokeShape="RoundRectangle 20" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding PlayPauseCommand2}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="18" SymbolName="{Binding PlayPauseIcon2}" TintColor="Black" WidthRequest="18" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SeekForwardCommand2}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="goforward.5" TintColor="White" WidthRequest="16" />
                                </Border>
                                <Border Padding="8" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 6" StrokeThickness="0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FrameForwardCommand2}" />
                                    </Border.GestureRecognizers>
                                    <controls:SymbolIcon HeightRequest="16" SymbolName="forward.frame.fill" TintColor="White" WidthRequest="16" />
                                </Border>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!--  Layout Vertical  -->
            <Grid
                RowDefinitions="*,Auto,*,Auto"
                RowSpacing="8"
                IsVisible="{Binding IsVerticalOrientation}">
                <!--  Vídeo 1  -->
                <Border
                    BackgroundColor="#FF1A1A1A"
                    Stroke="#FF3A3A3A"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <Grid>
                        <precision:PrecisionVideoPlayer
                            x:Name="MediaPlayer1V"
                            Aspect="AspectFit"
                            IsMuted="False"
                            Source="{Binding Video1.LocalClipPath}" />
                        <!--  Nombre del atleta  -->
                        <Border
                            Margin="12"
                            Padding="8,4"
                            BackgroundColor="#99000000"
                            HorizontalOptions="Start"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0"
                            VerticalOptions="End">
                            <Label
                                FontSize="12"
                                Text="{Binding Video1.Atleta.NombreCompleto}"
                                TextColor="White" />
                        </Border>
                    </Grid>
                </Border>
                <!--  Controles individuales Video 1 Vertical (modo individual)  -->
                <Border
                    Grid.Row="1"
                    Padding="12,6"
                    BackgroundColor="#FF1A1A1A"
                    IsVisible="{Binding IsIndividualMode}"
                    Stroke="#FF3A3A3A"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="8">
                        <Label
                            Text="{Binding CurrentPositionText1}"
                            TextColor="#FFB1B1B1"
                            FontSize="10"
                            VerticalOptions="Center" />
                        <Slider
                            x:Name="ProgressSlider1V"
                            Grid.Column="1"
                            Maximum="1"
                            Minimum="0"
                            Value="{Binding Progress1}"
                            ThumbColor="#FF6DDDFF"
                            MinimumTrackColor="#FF6DDDFF"
                            MaximumTrackColor="#FF3A3A3A"
                            DragStarted="OnSlider1DragStarted"
                            ValueChanged="OnSlider1ValueChanged"
                            DragCompleted="OnSlider1DragCompleted"
                            VerticalOptions="Center" />
                        <Label
                            Grid.Column="2"
                            Text="{Binding DurationText1}"
                            TextColor="#FFB1B1B1"
                            FontSize="10"
                            VerticalOptions="Center" />
                        <HorizontalStackLayout Grid.Column="3" Spacing="4">
                            <Border Padding="6" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand1}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="gobackward.5" TintColor="White" WidthRequest="14" />
                            </Border>
                            <Border Padding="8" BackgroundColor="#FF6DDDFF" StrokeShape="RoundRectangle 16" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand1}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="{Binding PlayPauseIcon1}" TintColor="Black" WidthRequest="14" />
                            </Border>
                            <Border Padding="6" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand1}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="goforward.5" TintColor="White" WidthRequest="14" />
                            </Border>
                        </HorizontalStackLayout>
                    </Grid>
                </Border>
                <!--  Vídeo 2  -->
                <Border
                    Grid.Row="2"
                    BackgroundColor="#FF1A1A1A"
                    Stroke="#FF3A3A3A"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <Grid>
                        <precision:PrecisionVideoPlayer
                            x:Name="MediaPlayer2V"
                            Aspect="AspectFit"
                            IsMuted="False"
                            Source="{Binding Video2.LocalClipPath}" />
                        <!--  Nombre del atleta  -->
                        <Border
                            Margin="12"
                            Padding="8,4"
                            BackgroundColor="#99000000"
                            HorizontalOptions="Start"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0"
                            VerticalOptions="End">
                            <Label
                                FontSize="12"
                                Text="{Binding Video2.Atleta.NombreCompleto}"
                                TextColor="White" />
                        </Border>
                    </Grid>
                </Border>
                <!--  Controles individuales Video 2 Vertical (modo individual)  -->
                <Border
                    Grid.Row="3"
                    Padding="12,6"
                    BackgroundColor="#FF1A1A1A"
                    IsVisible="{Binding IsIndividualMode}"
                    Stroke="#FF3A3A3A"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="8">
                        <Label
                            Text="{Binding CurrentPositionText2}"
                            TextColor="#FFB1B1B1"
                            FontSize="10"
                            VerticalOptions="Center" />
                        <Slider
                            x:Name="ProgressSlider2V"
                            Grid.Column="1"
                            Maximum="1"
                            Minimum="0"
                            Value="{Binding Progress2}"
                            ThumbColor="#FF6DDDFF"
                            MinimumTrackColor="#FF6DDDFF"
                            MaximumTrackColor="#FF3A3A3A"
                            DragStarted="OnSlider2DragStarted"
                            ValueChanged="OnSlider2ValueChanged"
                            DragCompleted="OnSlider2DragCompleted"
                            VerticalOptions="Center" />
                        <Label
                            Grid.Column="2"
                            Text="{Binding DurationText2}"
                            TextColor="#FFB1B1B1"
                            FontSize="10"
                            VerticalOptions="Center" />
                        <HorizontalStackLayout Grid.Column="3" Spacing="4">
                            <Border Padding="6" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekBackwardCommand2}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="gobackward.5" TintColor="White" WidthRequest="14" />
                            </Border>
                            <Border Padding="8" BackgroundColor="#FF6DDDFF" StrokeShape="RoundRectangle 16" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PlayPauseCommand2}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="{Binding PlayPauseIcon2}" TintColor="Black" WidthRequest="14" />
                            </Border>
                            <Border Padding="6" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SeekForwardCommand2}" />
                                </Border.GestureRecognizers>
                                <controls:SymbolIcon HeightRequest="14" SymbolName="goforward.5" TintColor="White" WidthRequest="14" />
                            </Border>
                        </HorizontalStackLayout>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!--  Controles globales (modo simultáneo)  -->
        <Border
            Grid.Row="1"
            Margin="20"
            Padding="16"
            BackgroundColor="#FF1A1A1A"
            IsVisible="{Binding IsSimultaneousMode}"
            Stroke="#FF3A3A3A"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1">
            <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                <!--  Barra de progreso  -->
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                    <Label
                        Text="{Binding CurrentPositionText}"
                        TextColor="#FFB1B1B1"
                        VerticalOptions="Center"
                        FontSize="12"
                        WidthRequest="70" />
                    <Slider
                        x:Name="ProgressSlider"
                        Grid.Column="1"
                        Maximum="1"
                        Minimum="0"
                        Value="{Binding Progress}"
                        ThumbColor="#FF6DDDFF"
                        MinimumTrackColor="#FF6DDDFF"
                        MaximumTrackColor="#FF3A3A3A"
                        DragStarted="OnSliderDragStarted"
                        ValueChanged="OnSliderValueChanged"
                        DragCompleted="OnSliderDragCompleted" />
                    <Label
                        Grid.Column="2"
                        Text="{Binding DurationText}"
                        TextColor="#FFB1B1B1"
                        VerticalOptions="Center"
                        FontSize="12"
                        WidthRequest="70" />
                </Grid>

                <!--  Controles principales  -->
                <HorizontalStackLayout
                    Grid.Row="1"
                    HorizontalOptions="Center"
                    Spacing="16">
                    <!--  Frame anterior  -->
                    <Border
                        Padding="12"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding FrameBackwardCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="20"
                            SymbolName="backward.frame.fill"
                            TintColor="White"
                            WidthRequest="20" />
                    </Border>

                    <!--  Retroceder 5s  -->
                    <Border
                        Padding="12"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SeekBackwardCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="20"
                            SymbolName="gobackward.5"
                            TintColor="White"
                            WidthRequest="20" />
                    </Border>

                    <!--  Play/Pause  -->
                    <Border
                        Padding="16"
                        BackgroundColor="#FF6DDDFF"
                        StrokeShape="RoundRectangle 25"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PlayPauseCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="24"
                            SymbolName="{Binding PlayPauseIcon}"
                            TintColor="Black"
                            WidthRequest="24" />
                    </Border>

                    <!--  Avanzar 5s  -->
                    <Border
                        Padding="12"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SeekForwardCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="20"
                            SymbolName="goforward.5"
                            TintColor="White"
                            WidthRequest="20" />
                    </Border>

                    <!--  Frame siguiente  -->
                    <Border
                        Padding="12"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding FrameForwardCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="20"
                            SymbolName="forward.frame.fill"
                            TintColor="White"
                            WidthRequest="20" />
                    </Border>
                </HorizontalStackLayout>

                <!--  Controles secundarios  -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto,Auto">
                    <!--  Velocidad  -->
                    <HorizontalStackLayout Spacing="8">
                        <Label
                            Text="Velocidad:"
                            TextColor="#FFB1B1B1"
                            VerticalOptions="Center"
                            FontSize="12" />
                        <Border
                            Padding="8,4"
                            BackgroundColor="#FF2A2A2A"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="0.25" />
                            </Border.GestureRecognizers>
                            <Label Text="0.25x" TextColor="White" FontSize="11" />
                        </Border>
                        <Border
                            Padding="8,4"
                            BackgroundColor="#FF2A2A2A"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="0.5" />
                            </Border.GestureRecognizers>
                            <Label Text="0.5x" TextColor="White" FontSize="11" />
                        </Border>
                        <Border
                            Padding="8,4"
                            BackgroundColor="#FF2A2A2A"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="1" />
                            </Border.GestureRecognizers>
                            <Label Text="1x" TextColor="White" FontSize="11" />
                        </Border>
                        <Border
                            Padding="8,4"
                            BackgroundColor="#FF2A2A2A"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="2" />
                            </Border.GestureRecognizers>
                            <Label Text="2x" TextColor="White" FontSize="11" />
                        </Border>
                        <Label
                            Margin="8,0,0,0"
                            Text="{Binding SpeedText}"
                            TextColor="#FF6DDDFF"
                            VerticalOptions="Center"
                            FontSize="12"
                            FontAttributes="Bold" />
                    </HorizontalStackLayout>

                    <!--  Toggle orientación  -->
                    <HorizontalStackLayout
                        Grid.Column="1"
                        HorizontalOptions="Center"
                        Spacing="8">
                        <Border
                            Padding="10,6"
                            BackgroundColor="{Binding IsHorizontalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF6DDDFF|#FF2A2A2A'}"
                            StrokeShape="RoundRectangle 6"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ToggleOrientationCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="6">
                                <controls:SymbolIcon
                                    HeightRequest="16"
                                    SymbolName="rectangle.split.2x1"
                                    TintColor="{Binding IsHorizontalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                                    WidthRequest="16" />
                                <Label
                                    Text="Horizontal"
                                    TextColor="{Binding IsHorizontalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                                    FontSize="12" />
                            </HorizontalStackLayout>
                        </Border>
                        <Border
                            Padding="10,6"
                            BackgroundColor="{Binding IsVerticalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF6DDDFF|#FF2A2A2A'}"
                            StrokeShape="RoundRectangle 6"
                            StrokeThickness="0">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ToggleOrientationCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="6">
                                <controls:SymbolIcon
                                    HeightRequest="16"
                                    SymbolName="rectangle.split.1x2"
                                    TintColor="{Binding IsVerticalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                                    WidthRequest="16" />
                                <Label
                                    Text="Vertical"
                                    TextColor="{Binding IsVerticalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                                    FontSize="12" />
                            </HorizontalStackLayout>
                        </Border>
                    </HorizontalStackLayout>

                    <!--  Toggle modo  -->
                    <Border
                        Grid.Column="2"
                        Margin="16,0"
                        Padding="12,8"
                        BackgroundColor="#FF2A2A2A"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleModeCommand}" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="6">
                            <controls:SymbolIcon
                                HeightRequest="16"
                                SymbolName="{Binding ModeIcon}"
                                TintColor="#FF6DDDFF"
                                WidthRequest="16" />
                            <Label
                                Text="{Binding ModeText}"
                                TextColor="White"
                                FontSize="12" />
                        </HorizontalStackLayout>
                    </Border>

                    <!--  Botón cerrar  -->
                    <Border
                        Grid.Column="3"
                        Padding="12,8"
                        BackgroundColor="#FFFF6B6B"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding CloseCommand}" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="6">
                            <controls:SymbolIcon
                                HeightRequest="16"
                                SymbolName="xmark"
                                TintColor="White"
                                WidthRequest="16" />
                            <Label
                                Text="Cerrar"
                                TextColor="White"
                                FontSize="12" />
                        </HorizontalStackLayout>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <!--  Barra inferior (modo individual) - Solo toggle modo y cerrar  -->
        <Border
            Grid.Row="1"
            Margin="20"
            Padding="16,12"
            BackgroundColor="#FF1A1A1A"
            IsVisible="{Binding IsIndividualMode}"
            Stroke="#FF3A3A3A"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <!--  Velocidad  -->
                <HorizontalStackLayout Spacing="8">
                    <Label
                        Text="Velocidad:"
                        TextColor="#FFB1B1B1"
                        VerticalOptions="Center"
                        FontSize="12" />
                    <Border Padding="8,4" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="0.25" />
                        </Border.GestureRecognizers>
                        <Label Text="0.25x" TextColor="White" FontSize="11" />
                    </Border>
                    <Border Padding="8,4" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="0.5" />
                        </Border.GestureRecognizers>
                        <Label Text="0.5x" TextColor="White" FontSize="11" />
                    </Border>
                    <Border Padding="8,4" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="1" />
                        </Border.GestureRecognizers>
                        <Label Text="1x" TextColor="White" FontSize="11" />
                    </Border>
                    <Border Padding="8,4" BackgroundColor="#FF2A2A2A" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SetSpeedCommand}" CommandParameter="2" />
                        </Border.GestureRecognizers>
                        <Label Text="2x" TextColor="White" FontSize="11" />
                    </Border>
                    <Label
                        Margin="8,0,0,0"
                        Text="{Binding SpeedText}"
                        TextColor="#FF6DDDFF"
                        VerticalOptions="Center"
                        FontSize="12"
                        FontAttributes="Bold" />
                </HorizontalStackLayout>

                <!--  Toggle orientación  -->
                <HorizontalStackLayout
                    Grid.Column="1"
                    HorizontalOptions="Center"
                    Spacing="8">
                    <Border
                        Padding="10,6"
                        BackgroundColor="{Binding IsHorizontalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF6DDDFF|#FF2A2A2A'}"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleOrientationCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="16"
                            SymbolName="rectangle.split.2x1"
                            TintColor="{Binding IsHorizontalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                            WidthRequest="16" />
                    </Border>
                    <Border
                        Padding="10,6"
                        BackgroundColor="{Binding IsVerticalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FF6DDDFF|#FF2A2A2A'}"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleOrientationCommand}" />
                        </Border.GestureRecognizers>
                        <controls:SymbolIcon
                            HeightRequest="16"
                            SymbolName="rectangle.split.1x2"
                            TintColor="{Binding IsVerticalOrientation, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Black|White'}"
                            WidthRequest="16" />
                    </Border>
                </HorizontalStackLayout>

                <!--  Toggle modo  -->
                <Border
                    Grid.Column="2"
                    Margin="16,0"
                    Padding="12,8"
                    BackgroundColor="#FF6DDDFF"
                    StrokeShape="RoundRectangle 6"
                    StrokeThickness="0">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleModeCommand}" />
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout Spacing="6">
                        <controls:SymbolIcon
                            HeightRequest="16"
                            SymbolName="{Binding ModeIcon}"
                            TintColor="Black"
                            WidthRequest="16" />
                        <Label
                            Text="{Binding ModeText}"
                            TextColor="Black"
                            FontSize="12" />
                    </HorizontalStackLayout>
                </Border>

                <!--  Botón cerrar  -->
                <Border
                    Grid.Column="3"
                    Padding="12,8"
                    BackgroundColor="#FFFF6B6B"
                    StrokeShape="RoundRectangle 6"
                    StrokeThickness="0">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding CloseCommand}" />
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout Spacing="6">
                        <controls:SymbolIcon
                            HeightRequest="16"
                            SymbolName="xmark"
                            TintColor="White"
                            WidthRequest="16" />
                        <Label
                            Text="Cerrar"
                            TextColor="White"
                            FontSize="12" />
                    </HorizontalStackLayout>
                </Border>
            </Grid>
        </Border>
    </Grid>
</ContentPage>
